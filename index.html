<!DOCTYPE html>
<html>
<head>
    <title>Editable, draggable ordering test</title>
    <link rel="stylesheet" type="text/css" href="dragula.css">
    <link rel="stylesheet" type="text/css" href="edit-order.css">
</head>
<body>
<script type="text/javascript" src="dragula.js"></script>
<script type="text/javascript" src="FileSaver.js"></script>
<script type="text/javascript">
function buildOrderText() {
    var list = document.getElementById('list');
    var rows = list.children;

    // forEach method from http://toddmotto.com/ditch-the-array-foreach-call-nodelist-hack/
    var nodeListForEach = function (array, callback, scope) {
        for (var i = 0; i < array.length; i++) {
           callback.call(scope, i, array[i]);
        }
    };

    var rowTexts = [];
    nodeListForEach(rows, function (index, row) {
        rowTexts.push(index.toString());
        rowTexts.push(" ");
        rowTexts.push(row.firstElementChild.textContent);
        rowTexts.push("\n");
    });
    return rowTexts;
}
function clickSave() {
    saveAs(
        new Blob(
            //[text.value || text.placeholder],
            buildOrderText(),
            {type: "text/plain;charset=" + document.characterSet}
        ),
        "order.txt"
        //, (text_filename.value || text_filename.placeholder) + ".txt"
    );
}
function setupSave() {
    var saveButton = document.querySelector('#save');
    saveButton.addEventListener("click", clickSave, false);
}
function setupDrag() {
    dragula([document.querySelector('#list')]);
}
function setup() {
    setupSave();
    setupDrag();
}

if (window.addEventListener) {
    window.addEventListener("load", setup, false);
} else if (window.attachEvent) {
    window.attachEvent("onload", setup);
} else {
    window.onload = setup;
}
</script>
</body>
<buttton id="save" type="button">Save</buttton>
<table>
    <thead>
    <tr>
        <th colspan="4">Original</th>
        <th colspan="4">table heading</th>
        <th colspan="4">table heading</th>
        <th colspan="4">table heading</th>
        <th colspan="4">table heading</th>
        <th colspan="1"></th>
        <th colspan="4">Current Pos</th>
    </tr>
    </thead>
    <tfoot>
    <tr>
        <th colspan="4">Original</th>
        <th colspan="4">table footer</th>
        <th colspan="4">table footer</th>
        <th colspan="4">table footer</th>
        <th colspan="4">table footer</th>
        <th colspan="1"></th>
        <th colspan="4">Current Pos</th>
    </tr>
    </tfoot>
    <tbody id="list">
    <tr>
        <th colspan="4">First Row</th>
        <td colspan="4">data</td>
        <td colspan="4">data</td>
        <td colspan="4">data</td>
        <td colspan="4">data</td>
        <td colspan="1"><div class="drag_handle">=</div></td>
        <td colspan="4">1</td>
    </tr>
    <tr>
        <th colspan="4">Second Row</th>
        <td colspan="4">data</td>
        <td colspan="4">data</td>
        <td colspan="4">data</td>
        <td colspan="4">data</td>
        <td colspan="1"><div class="drag_handle">=</div></td>
        <td colspan="4">2</td>
    </tr>
    <tr>
        <th colspan="4">Third Row</th>
        <td colspan="4">data</td>
        <td colspan="4">data</td>
        <td colspan="4">data</td>
        <td colspan="4">data</td>
        <td colspan="1"><div class="drag_handle">=</div></td>
        <td colspan="4">3</td>
    </tr>
    <tr>
        <th colspan="4">Fourth Row</th>
        <td colspan="4">data</td>
        <td colspan="4">data</td>
        <td colspan="4">data</td>
        <td colspan="4">data</td>
        <td colspan="1"><div class="drag_handle">=</div></td>
        <td colspan="4">4</td>
    </tr>
    <tr>
        <th colspan="4">Fifth Row</th>
        <td colspan="4">data</td>
        <td colspan="4">data</td>
        <td colspan="4">data</td>
        <td colspan="4">data</td>
        <td colspan="1"><div class="drag_handle">=</div></td>
        <td colspan="4">5</td>
    </tr>
    </tbody>
</table>
</html>